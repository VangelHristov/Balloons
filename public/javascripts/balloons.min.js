!function(){"use strict";function g(){function w(a){37===a.which?u.left=!1:39===a.which?u.right=!1:40===a.which?u.down=!1:38===a.which&&(u.up=!1)}function x(a){37===a.which?u.left=!0:39===a.which?u.right=!0:40===a.which?u.down=!0:38===a.which&&(u.up=!0),32===a.which&&B()}function y(){var a=o.getX(),d=o.getY();u.up&&d+t>t&&o.setY(d-v),u.down&&d+t<c-t&&o.setY(d+v),u.left&&a+s>s&&o.setX(a-v),u.right&&a+s<b-s&&o.setX(a+v)}function z(){var a=new Kinetic.Circle({x:e[Math.floor(Math.random()*e.length)],y:g[Math.floor(Math.random()*g.length)],radius:40*Math.random()+15,fill:d[Math.floor(Math.random()*l)],stroke:"black",lineWidth:1});a.deltaX=1,a.deltaY=1,a.horizontalOffset=Math.random()*k*j[Math.floor(2*Math.random())],a.verticalOffset=Math.random()*k*j[Math.floor(2*Math.random())],m.add(a),setTimeout(z,1e3)}function A(a){function d(b){if(b===a)return!1;var c={x:a.getX(),y:a.getY(),r:a.getRadius()},d={x:b.getX(),y:b.getY(),r:b.getRadius()},e=Math.sqrt((c.x-d.x)*(c.x-d.x)+(c.y-d.y)*(c.y-d.y));return e<=c.r+d.r}var e=a.getRadius(),f=a.getX(),g=a.getY(),h=a.deltaY,j=a.deltaX,k=f+j*a.horizontalOffset,l=g+h*a.verticalOffset;(k+e>=b||k-e<=0)&&(a.deltaX*=-1),(l-e<=0||l+e>=c)&&(a.deltaY*=-1),l+e>=c&&(i-=1),m.find("Circle").some(d)&&(a.deltaX+=-.1,a.deltaY+=-.1),C(a),a.setX(f+a.deltaX*a.horizontalOffset),a.setY(g+a.deltaY*a.verticalOffset)}function B(){var a=new Kinetic.Rect({x:o.getX()+s,y:o.getY(),width:5,height:10,fill:"black"});f.fireShot(),m.add(a)}function C(a){var b=a;m.find("Rect").forEach(function(a){var c=a.getX(),d=b.getX(),e=b.getRadius(),g=b.getY(),i=a.getY(),j=c<=d?d-e<c:d+e>c,k=i>=g?i<g-e:i<g+e,l=j&&k;l&&(f.pickCoin(),h+=Math.floor(e),b.remove())})}function D(a){var b=a.getY(),c=10,d=b-c;a!==o&&a.setY(d),d<=0&&a.remove()}function E(){p.setText("Lives: \n"+i+"\nScore: \n"+h)}function F(){m.find("Circle").forEach(A),m.find("Rect").forEach(D),E(),q=r(F),i<=0&&(window.cancelAnimationFrame(q),G()),y(),m.draw()}function G(){window.removeEventListener("keydown",x),window.removeEventListener("keyup",w),document.getElementById("new-game").classList.remove("hidden"),f.gameOver();var d=new Kinetic.Layer,e=new Kinetic.Text({fill:"black",fontFamily:"Edwardian script",textAlign:"center",textBaseline:"middle",fontSize:200,stroke:"red",x:b/5,y:c/10,text:"GAME OVER \n"});d.add(e),a.add(d),a.draw()}f.startGame(),document.getElementById("player-info").className="hidden";var a=new Kinetic.Stage({container:"balloons-container",width:(window.innerWidth||document.body.clientWidth)-25,height:(window.innerHeight||document.body.clientHeight)-50}),b=a.getWidth(),c=a.getHeight(),d=["red","blue","green","orange","purple","grey","pink","brown","yellow","lime"],e=[.3*b,.5*b,.75*b,b/2,b/3,b/4],g=[c/6,c/7,c/8,c/9],h=0,i=5,j=[-1,1],k=4,l=d.length-1,m=new Kinetic.Layer,n=new Image;n.src="images/plane.png",n.style.visibility="hidden",document.body.appendChild(n);var q,o=new Kinetic.Image({x:a.getWidth()/2,y:a.getHeight()-150,width:220,height:145,image:n}),p=new Kinetic.Text({x:50,y:50,text:"Lives: \n"+i+"\nScore: \n"+h,fontFamily:"Edwardian script",fontSize:50,stroke:"orange",fill:"white"}),r=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;m.add(p),m.add(o),a.add(m);var s=o.width()/2,t=o.height()/2,u={left:!1,right:!1,down:!1,up:!1},v=8;window.addEventListener("keydown",x),window.addEventListener("keyup",w),z(),F()}var a=document.getElementById("intro"),b=document.getElementById("theme"),c=document.getElementById("outro"),d=document.getElementsByClassName("shot"),e=document.getElementsByClassName("pickCoin"),f={gameOver:function(){b.pause(),c.play()},fireShot:function(){var a=d.length;do{if(d[a-1].paused){d[a-1].play();break}a-=1}while(a)},pickCoin:function(){var a=e.length;do{if(e[a-1].paused){e[a-1].play();break}a-=1}while(a)},startGame:function(){a.pause(),b.volume=.4,b.play()}};document.getElementById("player-info").addEventListener("submit",function(a){a.preventDefault(),g()}),document.getElementById("new-game").addEventListener("click",function(){window.location.reload(!0)})}();